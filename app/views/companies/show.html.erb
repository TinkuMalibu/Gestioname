<%= render @company %>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">


<div class="container">
  <div class="class row">
    <div class="col-4 mb-3">
      <div class="card-category">
        <div class="row">
          <div class="col-7">
            <div class="icono-chico mb-3">
              <i class="fa-solid fa-money-bill"></i>
            </div>
            <h5 class="text-body-tertiary">Total Balance</h5>
            <% if @total_amount < 0 %>
              <h3 class="text-danger fw-bold">$<%= number_with_delimiter(@total_amount.to_i, delimiter: '.', separator: ',')  %></h3>
            <% else %>
              <h3 class="text-success fw-bold">$<%= number_with_delimiter(@total_amount.to_i, delimiter: '.', separator: ',')  %></h3>
            <% end %>
            <h4>Balances</h4>
          </div>
          <div class="col-5 d-flex align-items-center justify-content-center">
            <h2>graph</h2>
          </div>
        </div>
      </div>
    </div>
    <div class="col-4 mb-3">
      <div class="card-category">
        <div class="row">
          <div class="col-7">
            <div class="icono-chico mb-3">
              <i class="fa-solid fa-chart-simple"></i>
            </div>
            <h5 class="text-body-tertiary">Total Expense</h5>
            <h3 class="text-black fw-bold">$<%= number_with_delimiter(@expense_amount.to_i, delimiter: '.', separator: ',')  %></h3>
            <%= link_to "expenses", company_expenses_path(@company), class:"btn btn-primary" %>
          </div>
          <div class="col-5 d-flex align-items-center justify-content-center">
            <h2>graph</h2>
          </div>
        </div>
      </div>
    </div>
    <div class="col-4 mb-3">
      <div class="card-category">
        <div class="row">
          <div class="col-7">
            <div class="icono-chico mb-3">
              <i class="fa-solid fa-chart-line"></i>
            </div>
            <h5 class="text-body-tertiary">Total Income</h5>
            <h3 class="text-black fw-bold">$<%= number_with_delimiter(@incomes_amount.to_i, delimiter: '.', separator: ',')  %></h3>
            <%= link_to "incomes", company_incomes_path(@company), class:"btn btn-primary" %>
          </div>
          <div class="col-5 d-flex align-items-center justify-content-center">
            <h2>graph</h2>
          </div>
        </div>
      </div>
    </div>
  </div>

  <% total_amount = 0 %>
  <% incomes_amount = 0 %>
  <% expense_amount = 0 %>

  <h2 class="fw-bold mt-3">Graphs</h2>

  <%# EN ESTE DIV DEBERIA IR GRAFICOS QUE IRÁ CAMBIANDO ??%>
  <div class="card-contenido">
    <%= pie_chart Expense.joins(:company).where(company_id: params[:id]).group(:item_name).sum("amount"), donut: true %>
    <%#= column_chart Expense.joins(:company).where(company_id: params[:id]).sum(:amount) %>
    <%#= bar_chart Expense.joins(:company).where(companies: {id: params[:id]}).sum(:amount) %>
  </div>

  <%# EN ESTE DIV DEBERIA IR TODO EL CONTENIDO QUE IRÁ CAMBIANDO ??%>
  <h2 class="fw-bold mt-3">Recent</h2>
  <div class="data-table">
    <table class="table table-striped table-bordered" id="example">
      <thead class="thead-dark">
        <tr>
          <th scope="col" class="filterable">Item Name</th>
          <th scope="col">Amount</th>
          <th scope="col">Date</th>
          <th scope="col">Details</th>
        </tr>
      </thead>
      <tbody>
        <% @registers.sort_by(&:date).reverse.each do |register| %>
          <tr>
            <td class="filterable" data-search="<%= register.item_name %>"><%= register.item_name %></td>
            <td>$ <%= register.amount %></td>
            <td><%= register.date %></td>
            <td><%= link_to '', expense_path(register), class: 'fa fa-info-circle' %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

<script>
 $(document).ready(function() {
  var table = $('#example').DataTable({
    buttons: ['copy', 'excel', 'pdf', 'print'],
    "order": [[0, "asc"]],
    "columnDefs": [
      {
        "targets": 'filterable',
        "searchable": true,
        "orderable": true
      }
    ],
    "pagingType": "full_numbers",
    "pageLength": 5,
    "lengthMenu": [5, 10, 25, 50]
  });

  table.buttons().container().appendTo('#example_wrapper .col-md-6:eq(0)');

  $('#example_wrapper .buttons-copy').on('click', function() {
    var filteredData = table.rows({ filter: 'applied' }).data().toArray();
    // Realizar acciones con los datos filtrados, como registrarlos
    toastr.success('Copy Successful!', 'Copy Message');
  });

  $('#example_wrapper .buttons-excel').on('click', function() {
    var filteredData = table.rows({ filter: 'applied' }).data().toArray();
    // Realizar acciones con los datos filtrados, como exportar a Excel o registrarlos
    toastr.success('Excel Download Successful!', 'Excel Message');
  });

  $('#example_wrapper .buttons-pdf').on('click', function() {
    var filteredData = table.rows({ filter: 'applied' }).data().toArray();
    // Realizar acciones con los datos filtrados, como exportar a PDF o registrarlos
    toastr.success('PDF Download Successful!', 'PDF Message');
  });

  $("#searchBtn").on("click", function() {
    table.draw();
  });
});
</script>


<div class="mt-3">
  <%= link_to "Back to companies", companies_path, class:"btn btn-primary" %>
</div>
